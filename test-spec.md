# テスト仕様書: Flask + OpenRouter AI チャットアプリ

## 1. テスト対象
- `app.py`（Flaskサーバー/APIバックエンド）
- `static/index.html`（フロントエンドUI）

## 2. テスト環境
- OS: Windows 11  
- Python 3.8 以降  
- 必須ライブラリ: Flask, requests, python-dotenv  
- OpenRouter APIキー設定済み  
- ブラウザ: Chrome, Edge, Brave

## 3. テスト項目

### 3.1. サーバー起動・静的ファイル配信
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 1  | サーバー起動 | ターミナルで `python app.py` を実行 | エラーなくサーバーが起動し、`http://localhost:5000/` にアクセス可能 |
| 2  | index.html配信 | ブラウザで `http://localhost:5000/` にアクセス | フロントエンドUI（HTML + Tailwindデザイン）が正しく表示される |

### 3.2. 冷蔵庫機能テスト
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 3  | 食材追加 | 食材画像をドラッグ＆ドロップ、消費期限入力 | 冷蔵庫欄に食材が表示され、サーバー側 `fridge` 配列に追加される |
| 4  | 食材削除 | 冷蔵庫内食材をクリック → 削除確認 → OK | 該当食材が表示から削除され、サーバー側 `fridge` 配列からも削除される |
| 5  | 冷蔵庫全削除 | 「全クリア」ボタンを押す | 冷蔵庫が空になり、サーバー側 `fridge` 配列も空になる |
| 6  | 空の冷蔵庫で献立生成 | 冷蔵庫が空の状態で「献立を提案」 | 「冷蔵庫が空です。食材を追加してください。」が表示される |

### 3.3. /get_menu API 正常系
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 7  | 献立生成 | 冷蔵庫に食材を追加 → 「献立を提案」 | AIから食材に基づいた献立が返り、番号付きリストとして表示される |
| 8  | max_tokens制限確認 | 長文プロンプトでも正常応答 | 応答が制限内で返る（エラーなし） |

### 3.4. /get_menu API 異常系
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 9  | APIキー未設定 | 環境変数 `OPENROUTER_API_KEY` を未設定 | エラー表示: OpenRouter API key is not configured on the server. |
| 10 | クレジット不足 | 無料枠を超えた場合 | エラー表示: API使用量不足やmax_tokens超過 |
| 11 | 通信エラー | OpenRouter APIが応答なし | エラー表示: AIサービスとの通信中にエラーが発生しました。 |
| 12 | 応答形式異常 | choicesフィールドがない場合 | エラー表示: API応答に問題があります |

### 3.5. UIテスト
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 13 | 献立表示 | AI応答正常時 | 結果欄に番号付きリストで献立が表示される |
| 14 | エラー表示 | エラー発生時 | 結果欄に「エラー: …」が表示される |
| 15 | リロード後の状態 | ページをリロード | 冷蔵庫の中身は初期化される（現在はサーバー保存のみ） |

### 3.6. その他
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 16 | 入力文字数制限 | 長文テキストを送信 | エラーが出ない、または適切にトリミングされる |
| 17 | 日本語以外の入力 | 英語・数字・記号を送信 | 正常にAI応答が返る |
| 18 | レスポンス速度 | 冷蔵庫に数種類食材 → 献立生成 | レスポンスが数秒以内に返る（目安: 5秒以内） |

---

💡 **補足**

- 食材削除は「名前＋消費期限」で判定  
- AI応答は `max_tokens` を適切に制限して無料枠で動作することを確認  
- エラーケースでは、フロントエンドに適切にエラーメッセージを表示すること
