<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>æ—¥æœ¬è¦³å…‰æ¤œç´¢ã‚¢ãƒ—ãƒª</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
<<<<<<< HEAD
=======
  <meta name="description" content="åœ°åã‚’å…¥åŠ›ã™ã‚‹ã¨ã€è¦³å…‰åœ°ã¨ã”å½“åœ°ã‚°ãƒ«ãƒ¡ã€å„è¦³å…‰åœ°ã®æœ€å¯„ã‚Šé§…/ãƒã‚¹åœã€æœ€å¯„ã‚Šãƒ›ãƒ†ãƒ«ï¼ˆè¤‡æ•°ï¼‰ã‚’è¡¨ç¤ºã™ã‚‹ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã€‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIé€£æºã‚’æƒ³å®šã€‚" />
  <style>
    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã®ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³è»½æ¸› */
    @media (prefers-reduced-motion: reduce) {
      * { animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration: 0.001ms !important; scroll-behavior: auto !important; }
    }
  </style>
>>>>>>> 5559ba3f7b7b46b915d2a09353d49661de5ef5c1
</head>
<body class="bg-gradient-to-r from-blue-100 via-pink-100 to-yellow-100 min-h-screen flex items-center justify-center">

  <div id="app" class="w-full max-w-3xl p-8 bg-white/90 backdrop-blur rounded-2xl shadow-2xl">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="text-center mb-6">
      <h1 class="text-3xl font-bold text-blue-700 mb-2">ğŸŒ¸ æ—¥æœ¬è¦³å…‰æ¤œç´¢ã‚¢ãƒ—ãƒª ğŸŒ¸</h1>
      <p class="text-gray-600">åœ°åã‚’å…¥åŠ›ã™ã‚‹ã¨è¦³å…‰åœ°ãƒ»é£Ÿã¹ç‰©ãƒ»ãƒ›ãƒ†ãƒ«ã‚’ãŠã™ã™ã‚ã—ã¾ã™</p>
    </div>

    <!-- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="flex gap-2 mb-6">
      <input v-model="query"
             type="text"
             placeholder="ä¾‹: äº¬éƒ½, æ±äº¬, æœ­å¹Œ..."
             class="flex-1 border-2 border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-400 outline-none">
      <button @click="search"
              class="bg-gradient-to-r from-blue-500 to-indigo-500 text-white px-6 py-3 rounded-xl shadow-md hover:scale-105 transition-transform">
        æ¤œç´¢
      </button>
    </div>

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
    <div v-if="loading" class="text-center text-gray-500 animate-pulse">æ¤œç´¢ä¸­ã§ã™...âœ¨</div>

    <!-- ã‚¨ãƒ©ãƒ¼ -->
    <div v-if="error" class="text-center text-red-500 font-semibold">{{ error }}</div>

    <!-- çµæœè¡¨ç¤º -->
    <div v-if="result" class="mt-6">
      <h2 class="text-xl font-semibold mb-4 text-indigo-600">ğŸ“ æ¤œç´¢çµæœ</h2>

      <!-- ç”»åƒè¡¨ç¤º-->
       <div v-if="image" class="mb-4">
        <img :src="image" alt="è¦³å…‰åœ°ã®å†™çœŸ" class="rounded-lg shadow-md w-full object-cover max-h-80">
       </div>

      <!-- èª¬æ˜ãƒ†ã‚­ã‚¹ãƒˆ-->
      <div class="p-4 border-l-4 border-indigo-400 bg-indigo-50 rounded-lg whitespace-pre-line text-gray-700 leading-relaxed">
        {{ result }}
      </div>
    </div>
  </div>

  <script>
<<<<<<< HEAD
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          query: "",
          result: null,
          image: null,
          loading: false,
          error: null
        };
      },
      methods: {
        async search() {
          if (!this.query) {
            this.error = "åœ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„";
            return;
          }
          this.loading = true;
          this.error = null;
          this.result = null;
=======
    // =====================
    // â˜… API ä»•æ§˜ï¼ˆæƒ³å®šï¼‰â˜…
    // =====================
    // 1) è¦³å…‰åœ° & ã”å½“åœ°ã‚°ãƒ«ãƒ¡å–å¾—ï¼ˆåœ°åã‹ã‚‰ï¼‰
    // GET /api/attractions?place={place}
    // Response JSON ä¾‹ï¼š
    // {
    //   "place": "äº¬éƒ½",
    //   "foods": ["æ¹¯è±†è…", "æŠ¹èŒ¶ã‚¹ã‚¤ãƒ¼ãƒ„", "ã«ã—ã‚“ãã°"],
    //   "attractions": [
    //     {
    //       "id": "a1",
    //       "name": "æ¸…æ°´å¯º",
    //       "description": "ä¸–ç•Œéºç”£ã€‚èˆå°ã‹ã‚‰ã®çœºæœ›ã§æœ‰åã€‚",
    //       "address": "äº¬éƒ½å¸‚æ±å±±åŒºæ¸…æ°´",
    //       "location": { "lat": 34.994856, "lng": 135.785046 },
    //       "nearestTransit": { "type": "bus", "name": "æ¸…æ°´é“ãƒã‚¹åœ", "lines": ["å¸‚ãƒã‚¹"], "distanceMeters": 450 }
    //     },
    //     {
    //       "id": "a2",
    //       "name": "ä¼è¦‹ç¨²è·å¤§ç¤¾",
    //       "description": "åƒæœ¬é³¥å±…ã§æœ‰åã€‚",
    //       "address": "äº¬éƒ½å¸‚ä¼è¦‹åŒºæ·±è‰è—ªä¹‹å†…ç”º68",
    //       "location": { "lat": 34.96714, "lng": 135.77267 },
    //       "nearestTransit": { "type": "station", "name": "ç¨²è·é§…", "lines": ["JRå¥ˆè‰¯ç·š"], "distanceMeters": 120 }
    //     }
    //   ]
    // }
    //
    // 2) ãƒ›ãƒ†ãƒ«æ¤œç´¢ï¼ˆè¦³å…‰åœ°åº§æ¨™ã‹ã‚‰è¿‘ã„é †ã§è¤‡æ•°ä»¶ï¼‰
    // GET /api/hotels?lat={lat}&lng={lng}&limit={n}
    // Response JSON ä¾‹ï¼š
    // {
    //   "hotels": [
    //     { "name": "ãƒ›ãƒ†ãƒ«A", "price": 12400, "currency": "JPY", "distanceMeters": 220, "address": "...", "url": "https://..." },
    //     { "name": "ãƒ›ãƒ†ãƒ«B", "price": 14800, "currency": "JPY", "distanceMeters": 350, "address": "...", "url": "https://..." }
    //   ]
    // }

    // === ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©ï¼ˆå¿…è¦ã«å¿œã˜ã¦æ›¸ãæ›ãˆï¼‰ ===
    const API_ENDPOINTS = {
    attractions: "/api/attractions",
    hotels: "/api/hotels"
    };

    // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    const qs = (s, el=document) => el.querySelector(s);
    const qsa = (s, el=document) => [...el.querySelectorAll(s)];
    const yen = (n) => n.toLocaleString("ja-JP", { style: "currency", currency: "JPY" });
    const m2str = (m) => (m >= 1000 ? `${(m/1000).toFixed(1)} km` : `${Math.round(m)} m`);

    // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æœªå®Ÿè£…æ™‚ã«ä¾¿åˆ©ï¼‰
    function demoResponse(place) {
      const seed = (place || "").trim() || "éŒå€‰";
      if (/æœ­å¹Œ|åŒ—æµ·é“/i.test(seed)) {
        return {
          place: "æœ­å¹Œ",
          foods: ["ã‚¸ãƒ³ã‚®ã‚¹ã‚«ãƒ³", "ã‚¹ãƒ¼ãƒ—ã‚«ãƒ¬ãƒ¼", "æœ­å¹Œãƒ©ãƒ¼ãƒ¡ãƒ³"],
          attractions: [
            { id: "s1", name: "å¤§é€šå…¬åœ’", description: "éƒ½å¿ƒã®æ†©ã„ã®å ´ã€‚å­£ç¯€ã®ã‚¤ãƒ™ãƒ³ãƒˆå¤šæ•°ã€‚", address: "æœ­å¹Œå¸‚ä¸­å¤®åŒºå¤§é€šè¥¿", location: {lat:43.0601,lng:141.3565}, nearestTransit: {type:"station", name:"å¤§é€šé§…", lines:["å—åŒ—ç·š","æ±è¥¿ç·š","æ±è±Šç·š"], distanceMeters: 180} },
            { id: "s2", name: "è—»å²©å±±", description: "æ—¥æœ¬æ–°ä¸‰å¤§å¤œæ™¯ã®ä¸€ã¤ã€‚", address: "æœ­å¹Œå¸‚å—åŒºè—»å²©å±±", location: {lat:43.0169,lng:141.3305}, nearestTransit: {type:"bus", name:"ã‚‚ã„ã‚å±±ãƒ­ãƒ¼ãƒ—ã‚¦ã‚§ã‚¤å…¥å£", lines:["å¸‚é›»â‡”ãƒã‚¹"], distanceMeters: 420} }
          ]
        };
      }
      // æ—¢å®šã¯äº¬éƒ½
      return {
        place: "äº¬éƒ½",
        foods: ["æ¹¯è±†è…", "æŠ¹èŒ¶ã‚¹ã‚¤ãƒ¼ãƒ„", "ã«ã—ã‚“ãã°"],
        attractions: [
          { id: "k1", name: "æ¸…æ°´å¯º", description: "ä¸–ç•Œéºç”£ã€‚èˆå°ã‹ã‚‰ã®çœºæœ›ã§æœ‰åã€‚", address: "äº¬éƒ½å¸‚æ±å±±åŒºæ¸…æ°´", location: {lat:34.994856,lng:135.785046}, nearestTransit: {type:"bus", name:"æ¸…æ°´é“ãƒã‚¹åœ", lines:["å¸‚ãƒã‚¹"], distanceMeters: 450} },
          { id: "k2", name: "ä¼è¦‹ç¨²è·å¤§ç¤¾", description: "åƒæœ¬é³¥å±…ã§æœ‰åã€‚", address: "äº¬éƒ½å¸‚ä¼è¦‹åŒºæ·±è‰è—ªä¹‹å†…ç”º68", location: {lat:34.96714,lng:135.77267}, nearestTransit: {type:"station", name:"ç¨²è·é§…", lines:["JRå¥ˆè‰¯ç·š"], distanceMeters: 120} }
        ]
      };
    }
>>>>>>> 5559ba3f7b7b46b915d2a09353d49661de5ef5c1

          try {
            const response = await fetch("/search", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ query: this.query })
            });
            const data = await response.json();
            if (data.error) {
              this.error = data.error;
            } else {
              this.result = data.result;
              this.image = data.image;
            }
          } catch (err) {
            this.error = "ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: " + err;
          } finally {
            this.loading = false;
          }
        }
<<<<<<< HEAD
      }
    }).mount("#app");
=======
      });
    }

    function renderFoods(root, foods) {
      if (!foods || foods.length === 0) { root.classList.add('hidden'); return; }
      root.classList.remove('hidden');
      root.innerHTML = `
        <h3 class="text-lg font-semibold mb-2">ã”å½“åœ°ã‚°ãƒ«ãƒ¡</h3>
        <ul class="flex flex-wrap gap-2">${foods.map(f => `<li class="px-3 py-1 rounded-full bg-slate-100 border text-sm">${f}</li>`).join('')}</ul>
      `;
    }

    function renderAttractions(root, attractions) {
      root.innerHTML = '';
      for (const a of attractions) {
        const card = document.createElement('article');
        card.className = 'bg-white rounded-2xl shadow p-4';
        const transit = a.nearestTransit;
        const transitIcon = transit?.type === 'station' ? 'ğŸš‰' : 'ğŸšŒ';
        const lines = (transit?.lines || []).join(' / ');
        card.innerHTML = `
          <div class="flex items-start gap-3">
            <div class="text-2xl">ğŸ“</div>
            <div class="flex-1">
              <h4 class="text-lg font-semibold">${a.name}</h4>
              <p class="text-sm text-slate-600">${a.description || ''}</p>
              <p class="text-sm text-slate-600 mt-1">ä½æ‰€: ${a.address || '-'} </p>
              <div class="mt-2 text-sm">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-sky-50 border border-sky-200">
                  <span>${transitIcon} æœ€å¯„ã‚Š${transit?.type === 'station' ? 'é§…' : 'ãƒã‚¹åœ'}</span>
                  <strong>${transit?.name || '-'}</strong>
                  ${lines ? `<span class="text-slate-500">(${lines})</span>` : ''}
                  ${transit?.distanceMeters ? `<span class="text-slate-500">ãƒ»ç´„ ${m2str(transit.distanceMeters)}</span>` : ''}
                </div>
              </div>
              <details class="mt-3 group">
                <summary class="cursor-pointer select-none text-sm text-slate-700">ãƒ›ãƒ†ãƒ«ã‚’è¡¨ç¤ºï¼ˆè¿‘ã„é †ï¼‰</summary>
                <div class="mt-3" id="hotels-${a.id}">
                  <div class="text-sm text-slate-500">èª­ã¿è¾¼ã¿ä¸­...</div>
                </div>
              </details>
            </div>
          </div>
        `;
        root.appendChild(card);
        // ãƒ›ãƒ†ãƒ«èª­ã¿è¾¼ã¿ï¼ˆé…å»¶ï¼‰
        const details = card.querySelector('details');
        details.addEventListener('toggle', async () => {
          if (!details.open) return;
          const container = qs(`#hotels-${a.id}`);
          await loadHotelsForAttraction(a, container);
        }, { once: true });
      }
    }

    function renderHotels(container, hotels) {
      if (!hotels || hotels.length === 0) {
        container.innerHTML = '<p class="text-sm text-slate-500">è¿‘éš£ãƒ›ãƒ†ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
        return;
      }
      container.innerHTML = `
        <ul class="space-y-2">
          ${hotels.map(h => `
            <li class="border rounded-xl p-3 flex flex-col md:flex-row md:items-center md:justify-between gap-2">
              <div>
                <p class="font-medium">${h.name}</p>
                <p class="text-xs text-slate-600">${h.address || ''}</p>
                ${h.distanceMeters ? `<p class="text-xs text-slate-500">è¦³å…‰åœ°ã‹ã‚‰ç´„ ${m2str(h.distanceMeters)}</p>` : ''}
              </div>
              <div class="flex items-center gap-3">
                <span class="text-base font-semibold">${h.price ? yen(h.price) : '-'}${h.currency && h.currency !== 'JPY' ? ` <span class="text-xs">(${h.currency})</span>` : ''}</span>
                ${h.url ? `<a href="${h.url}" target="_blank" class="inline-flex items-center gap-1 text-sky-700 hover:underline text-sm">è©³ç´° <span aria-hidden>â†—</span></a>` : ''}
              </div>
            </li>`).join('')}
        </ul>
      `;
    }

    // ãƒˆãƒ¼ã‚¹ãƒˆç°¡æ˜“å®Ÿè£…
    function toast(msg, isError=false) {
      const t = document.createElement('div');
      t.className = `fixed bottom-4 left-1/2 -translate-x-1/2 rounded-xl px-4 py-2 shadow text-sm ${isError ? 'bg-red-600 text-white' : 'bg-slate-800 text-white'}`;
      t.textContent = msg;
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 2200);
    }

    // ============
    // ãƒ‡ãƒ¼ã‚¿å–å¾—
    // ============
    async function fetchAttractions(place) {
    const url = `${API_ENDPOINTS.attractions}?place=${encodeURIComponent(place)}`;
    const res = await fetch(url, { headers: { "Accept": "application/json" } });
    if (!res.ok) {
      let detail = ""; try { detail = (await res.json()).error } catch {}
      throw new Error(`è¦³å…‰åœ°APIã‚¨ãƒ©ãƒ¼ (${res.status}) ${detail || ""}`);
    }
    return res.json(); // ã‚µãƒ¼ãƒã¯ { place, foods, attractions } ã‚’è¿”ã™
    }

    async function fetchHotels({ lat, lng }, limit=4) {
      const url = new URL(API_ENDPOINTS.hotels, location.origin);
      url.searchParams.set('lat', String(lat));
      url.searchParams.set('lng', String(lng));
      url.searchParams.set('limit', String(limit));
      const res = await fetch(url.toString(), { headers: { 'Accept': 'application/json' } });
      if (!res.ok) throw new Error('ãƒ›ãƒ†ãƒ«APIã‚¨ãƒ©ãƒ¼');
      return res.json();
    }

    async function loadHotelsForAttraction(a, container) {
      try {
        const useDemo = qs('#demoToggle').checked;
        let data;
        if (useDemo) {
          await new Promise(r => setTimeout(r, 400));
          data = demoHotels(a.location.lat, a.location.lng, 4);
        } else {
          data = await fetchHotels(a.location, 4);
        }
        renderHotels(container, data.hotels || []);
      } catch (e) {
        container.innerHTML = `<p class="text-sm text-red-600">ãƒ›ãƒ†ãƒ«ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸï¼š${e.message}</p>`;
      }
    }

    // ============
    // ã‚¤ãƒ™ãƒ³ãƒˆ
    // ============
    const form = qs('#searchForm');
    const placeInput = qs('#placeInput');
    const results = qs('#results');
    const summaryCard = qs('#summaryCard');
    const foodsCard = qs('#foodsCard');
    const attractionsRoot = qs('#attractions');
    const statusEl = qs('#status');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const place = placeInput.value.trim();
      if (!place) return;
      results.classList.add('hidden');
      summaryCard.classList.add('hidden');
      foodsCard.classList.add('hidden');
      attractionsRoot.innerHTML = '';
      statusEl.innerHTML = '<div class="inline-flex items-center gap-2 text-slate-600"><span class="animate-spin inline-block w-4 h-4 border-2 border-slate-300 border-t-slate-600 rounded-full"></span> æ¤œç´¢ä¸­â€¦</div>';

      try {
        const useDemo = qs('#demoToggle').checked;
        let data;
        if (useDemo) {
          await new Promise(r => setTimeout(r, 600)); // ãƒ‡ãƒ¢ã‚‰ã—ãå°‘ã—å¾…æ©Ÿ
          data = demoResponse(place);
        } else {
          data = await fetchAttractions(place);
        }

        statusEl.textContent = '';
        results.classList.remove('hidden');
        summaryCard.classList.remove('hidden');
        renderSummary(summaryCard, data);
        renderFoods(foodsCard, data.foods || []);
        renderAttractions(attractionsRoot, data.attractions || []);
        if ((data.foods || []).length > 0) {
          foodsCard.classList.remove('hidden');
        }
      } catch (err) {
        statusEl.innerHTML = `<div class="text-red-600">ã‚¨ãƒ©ãƒ¼: ${err.message}</div>`;
      }
    });

    // ã‚¨ãƒ³ã‚¿ãƒ¼ã§åˆæœŸãƒ•ã‚©ãƒ¼ã‚«ã‚¹
    window.addEventListener('DOMContentLoaded', () => placeInput.focus());
>>>>>>> 5559ba3f7b7b46b915d2a09353d49661de5ef5c1
  </script>
</body>
</html>