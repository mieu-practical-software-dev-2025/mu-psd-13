<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ—¥æœ¬ã®åœ°åã‹ã‚‰è¦³å…‰åœ°ãƒ»é£Ÿã¹ç‰©ãƒ»æœ€å¯„ã‚Šäº¤é€šãƒ»ãƒ›ãƒ†ãƒ«è¡¨ç¤º</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="åœ°åã‚’å…¥åŠ›ã™ã‚‹ã¨ã€è¦³å…‰åœ°ã¨ã”å½“åœ°ã‚°ãƒ«ãƒ¡ã€å„è¦³å…‰åœ°ã®æœ€å¯„ã‚Šé§…/ãƒã‚¹åœã€æœ€å¯„ã‚Šãƒ›ãƒ†ãƒ«ï¼ˆè¤‡æ•°ï¼‰ã‚’è¡¨ç¤ºã™ã‚‹ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã€‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIé€£æºã‚’æƒ³å®šã€‚" />
  <style>
    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã®ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³è»½æ¸› */
    @media (prefers-reduced-motion: reduce) {
      * { animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration: 0.001ms !important; scroll-behavior: auto !important; }
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <header class="sticky top-0 z-10 bg-white/90 backdrop-blur border-b border-slate-200">
    <div class="max-w-5xl mx-auto p-4">
      <h1 class="text-2xl font-bold">è¦³å…‰ã‚¹ãƒãƒƒãƒˆ & ã”å½“åœ°ã‚°ãƒ«ãƒ¡ & æœ€å¯„ã‚Šäº¤é€š & ãƒ›ãƒ†ãƒ«æ¤œç´¢</h1>
      <p class="text-sm text-slate-600">åœ°åï¼ˆä¾‹: äº¬éƒ½ã€æœ­å¹Œã€é‚£è¦‡ã€éŒå€‰ ãªã©ï¼‰ã‚’å…¥ã‚Œã¦æ¤œç´¢</p>
    </div>
  </header>

  <main class="max-w-5xl mx-auto p-4 space-y-6">
    <!-- æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
    <section class="bg-white rounded-2xl shadow p-4">
      <form id="searchForm" class="grid grid-cols-1 md:grid-cols-[1fr_auto_auto] gap-3 items-center">
        <label for="placeInput" class="sr-only">åœ°å</label>
        <input id="placeInput" type="text" inputmode="search" placeholder="ä¾‹: é‡‘æ²¢ / ç¦å²¡ / æ—¥å…‰" class="w-full rounded-xl border border-slate-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-sky-400" required />
        <label class="inline-flex items-center gap-2 text-sm text-slate-600 select-none">
          <input id="demoToggle" type="checkbox" class="rounded border-slate-300" /> ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã†
        </label>
        <button type="submit" class="rounded-xl bg-sky-600 hover:bg-sky-700 text-white font-medium px-5 py-3">æ¤œç´¢</button>
      </form>
      <p class="mt-2 text-xs text-slate-500">â€» ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã¯åˆ¥å®Ÿè£…æƒ³å®šã€‚ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆURLã¯æœ¬ãƒ•ã‚¡ã‚¤ãƒ«å†…ã® <code>API_ENDPOINTS</code> ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚</p>
    </section>

    <!-- çµæœã‚³ãƒ³ãƒ†ãƒŠ -->
    <section id="results" class="space-y-6 hidden">
      <!-- æ¦‚è¦ -->
      <div id="summaryCard" class="bg-white rounded-2xl shadow p-4 hidden"></div>

      <!-- ã”å½“åœ°ã‚°ãƒ«ãƒ¡ãƒªã‚¹ãƒˆ -->
      <div id="foodsCard" class="bg-white rounded-2xl shadow p-4 hidden"></div>

      <!-- è¦³å…‰åœ°ã‚«ãƒ¼ãƒ‰ç¾¤ -->
      <div id="attractions" class="space-y-4"></div>
    </section>

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° / ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
    <section id="status" class="text-center text-slate-600"></section>
  </main>

  <footer class="max-w-5xl mx-auto p-8 text-center text-xs text-slate-500">
    ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã¿ã€‚ã‚µãƒ³ãƒ—ãƒ«APIä»•æ§˜ã¯ã‚³ãƒ¼ãƒ‰å†…ã‚³ãƒ¡ãƒ³ãƒˆå‚ç…§ã€‚
  </footer>

  <script>
    // =====================
    // â˜… API ä»•æ§˜ï¼ˆæƒ³å®šï¼‰â˜…
    // =====================
    // 1) è¦³å…‰åœ° & ã”å½“åœ°ã‚°ãƒ«ãƒ¡å–å¾—ï¼ˆåœ°åã‹ã‚‰ï¼‰
    // GET /api/attractions?place={place}
    // Response JSON ä¾‹ï¼š
    // {
    //   "place": "äº¬éƒ½",
    //   "foods": ["æ¹¯è±†è…", "æŠ¹èŒ¶ã‚¹ã‚¤ãƒ¼ãƒ„", "ã«ã—ã‚“ãã°"],
    //   "attractions": [
    //     {
    //       "id": "a1",
    //       "name": "æ¸…æ°´å¯º",
    //       "description": "ä¸–ç•Œéºç”£ã€‚èˆå°ã‹ã‚‰ã®çœºæœ›ã§æœ‰åã€‚",
    //       "address": "äº¬éƒ½å¸‚æ±å±±åŒºæ¸…æ°´",
    //       "location": { "lat": 34.994856, "lng": 135.785046 },
    //       "nearestTransit": { "type": "bus", "name": "æ¸…æ°´é“ãƒã‚¹åœ", "lines": ["å¸‚ãƒã‚¹"], "distanceMeters": 450 }
    //     },
    //     {
    //       "id": "a2",
    //       "name": "ä¼è¦‹ç¨²è·å¤§ç¤¾",
    //       "description": "åƒæœ¬é³¥å±…ã§æœ‰åã€‚",
    //       "address": "äº¬éƒ½å¸‚ä¼è¦‹åŒºæ·±è‰è—ªä¹‹å†…ç”º68",
    //       "location": { "lat": 34.96714, "lng": 135.77267 },
    //       "nearestTransit": { "type": "station", "name": "ç¨²è·é§…", "lines": ["JRå¥ˆè‰¯ç·š"], "distanceMeters": 120 }
    //     }
    //   ]
    // }
    //
    // 2) ãƒ›ãƒ†ãƒ«æ¤œç´¢ï¼ˆè¦³å…‰åœ°åº§æ¨™ã‹ã‚‰è¿‘ã„é †ã§è¤‡æ•°ä»¶ï¼‰
    // GET /api/hotels?lat={lat}&lng={lng}&limit={n}
    // Response JSON ä¾‹ï¼š
    // {
    //   "hotels": [
    //     { "name": "ãƒ›ãƒ†ãƒ«A", "price": 12400, "currency": "JPY", "distanceMeters": 220, "address": "...", "url": "https://..." },
    //     { "name": "ãƒ›ãƒ†ãƒ«B", "price": 14800, "currency": "JPY", "distanceMeters": 350, "address": "...", "url": "https://..." }
    //   ]
    // }

    // === ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©ï¼ˆå¿…è¦ã«å¿œã˜ã¦æ›¸ãæ›ãˆï¼‰ ===
    const API_ENDPOINTS = {
    attractions: "/api/attractions",
    hotels: "/api/hotels"
    };

    // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    const qs = (s, el=document) => el.querySelector(s);
    const qsa = (s, el=document) => [...el.querySelectorAll(s)];
    const yen = (n) => n.toLocaleString("ja-JP", { style: "currency", currency: "JPY" });
    const m2str = (m) => (m >= 1000 ? `${(m/1000).toFixed(1)} km` : `${Math.round(m)} m`);

    // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æœªå®Ÿè£…æ™‚ã«ä¾¿åˆ©ï¼‰
    function demoResponse(place) {
      const seed = (place || "").trim() || "éŒå€‰";
      if (/æœ­å¹Œ|åŒ—æµ·é“/i.test(seed)) {
        return {
          place: "æœ­å¹Œ",
          foods: ["ã‚¸ãƒ³ã‚®ã‚¹ã‚«ãƒ³", "ã‚¹ãƒ¼ãƒ—ã‚«ãƒ¬ãƒ¼", "æœ­å¹Œãƒ©ãƒ¼ãƒ¡ãƒ³"],
          attractions: [
            { id: "s1", name: "å¤§é€šå…¬åœ’", description: "éƒ½å¿ƒã®æ†©ã„ã®å ´ã€‚å­£ç¯€ã®ã‚¤ãƒ™ãƒ³ãƒˆå¤šæ•°ã€‚", address: "æœ­å¹Œå¸‚ä¸­å¤®åŒºå¤§é€šè¥¿", location: {lat:43.0601,lng:141.3565}, nearestTransit: {type:"station", name:"å¤§é€šé§…", lines:["å—åŒ—ç·š","æ±è¥¿ç·š","æ±è±Šç·š"], distanceMeters: 180} },
            { id: "s2", name: "è—»å²©å±±", description: "æ—¥æœ¬æ–°ä¸‰å¤§å¤œæ™¯ã®ä¸€ã¤ã€‚", address: "æœ­å¹Œå¸‚å—åŒºè—»å²©å±±", location: {lat:43.0169,lng:141.3305}, nearestTransit: {type:"bus", name:"ã‚‚ã„ã‚å±±ãƒ­ãƒ¼ãƒ—ã‚¦ã‚§ã‚¤å…¥å£", lines:["å¸‚é›»â‡”ãƒã‚¹"], distanceMeters: 420} }
          ]
        };
      }
      // æ—¢å®šã¯äº¬éƒ½
      return {
        place: "äº¬éƒ½",
        foods: ["æ¹¯è±†è…", "æŠ¹èŒ¶ã‚¹ã‚¤ãƒ¼ãƒ„", "ã«ã—ã‚“ãã°"],
        attractions: [
          { id: "k1", name: "æ¸…æ°´å¯º", description: "ä¸–ç•Œéºç”£ã€‚èˆå°ã‹ã‚‰ã®çœºæœ›ã§æœ‰åã€‚", address: "äº¬éƒ½å¸‚æ±å±±åŒºæ¸…æ°´", location: {lat:34.994856,lng:135.785046}, nearestTransit: {type:"bus", name:"æ¸…æ°´é“ãƒã‚¹åœ", lines:["å¸‚ãƒã‚¹"], distanceMeters: 450} },
          { id: "k2", name: "ä¼è¦‹ç¨²è·å¤§ç¤¾", description: "åƒæœ¬é³¥å±…ã§æœ‰åã€‚", address: "äº¬éƒ½å¸‚ä¼è¦‹åŒºæ·±è‰è—ªä¹‹å†…ç”º68", location: {lat:34.96714,lng:135.77267}, nearestTransit: {type:"station", name:"ç¨²è·é§…", lines:["JRå¥ˆè‰¯ç·š"], distanceMeters: 120} }
        ]
      };
    }

    function demoHotels(lat, lng, limit=4) {
      const base = [
        { name: "ãƒ›ãƒ†ãƒ«é›…", price: 12400, currency: "JPY", distanceMeters: 220, address: "ã€‡ã€‡å¸‚â–³â–³1-2-3", url: "https://example.com/hotel/miyabi" },
        { name: "æ—…é¤¨ ã“ã¨ã®ã¯", price: 15800, currency: "JPY", distanceMeters: 410, address: "ã€‡ã€‡å¸‚â–¡â–¡2-3-4", url: "https://example.com/hotel/kotonoha" },
        { name: "â—‹â—‹ã‚¤ãƒ³", price: 9800, currency: "JPY", distanceMeters: 530, address: "ã€‡ã€‡å¸‚Ã—Ã—3-4-5", url: "https://example.com/hotel/inn" },
        { name: "ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ›ãƒ†ãƒ«â–³â–³", price: 17600, currency: "JPY", distanceMeters: 690, address: "ã€‡ã€‡å¸‚â˜†å½¡4-5-6", url: "https://example.com/hotel/premium" }
      ];
      return { hotels: base.slice(0, limit) };
    }

    // ============
    // æç”»ãƒ˜ãƒ«ãƒ‘
    // ============
    function renderSummary(root, data) {
      root.innerHTML = `
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2">
          <div>
            <h2 class="text-xl font-semibold">${data.place} ã®æ¤œç´¢çµæœ</h2>
            <p class="text-slate-600 text-sm">è¦³å…‰åœ° ${data.attractions.length} ä»¶ / ã”å½“åœ°ã‚°ãƒ«ãƒ¡ ${data.foods?.length || 0} ä»¶</p>
          </div>
          <button id="copyBtn" class="mt-2 md:mt-0 inline-flex items-center gap-2 rounded-xl border px-3 py-2 text-sm hover:bg-slate-50">ã“ã®çµæœã®JSONã‚’ã‚³ãƒ”ãƒ¼</button>
        </div>`;
      qs('#copyBtn', root).addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(JSON.stringify(data, null, 2));
          toast('JSONã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
        } catch {
          toast('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', true);
        }
      });
    }

    function renderFoods(root, foods) {
      if (!foods || foods.length === 0) { root.classList.add('hidden'); return; }
      root.classList.remove('hidden');
      root.innerHTML = `
        <h3 class="text-lg font-semibold mb-2">ã”å½“åœ°ã‚°ãƒ«ãƒ¡</h3>
        <ul class="flex flex-wrap gap-2">${foods.map(f => `<li class="px-3 py-1 rounded-full bg-slate-100 border text-sm">${f}</li>`).join('')}</ul>
      `;
    }

    function renderAttractions(root, attractions) {
      root.innerHTML = '';
      for (const a of attractions) {
        const card = document.createElement('article');
        card.className = 'bg-white rounded-2xl shadow p-4';
        const transit = a.nearestTransit;
        const transitIcon = transit?.type === 'station' ? 'ğŸš‰' : 'ğŸšŒ';
        const lines = (transit?.lines || []).join(' / ');
        card.innerHTML = `
          <div class="flex items-start gap-3">
            <div class="text-2xl">ğŸ“</div>
            <div class="flex-1">
              <h4 class="text-lg font-semibold">${a.name}</h4>
              <p class="text-sm text-slate-600">${a.description || ''}</p>
              <p class="text-sm text-slate-600 mt-1">ä½æ‰€: ${a.address || '-'} </p>
              <div class="mt-2 text-sm">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-sky-50 border border-sky-200">
                  <span>${transitIcon} æœ€å¯„ã‚Š${transit?.type === 'station' ? 'é§…' : 'ãƒã‚¹åœ'}</span>
                  <strong>${transit?.name || '-'}</strong>
                  ${lines ? `<span class="text-slate-500">(${lines})</span>` : ''}
                  ${transit?.distanceMeters ? `<span class="text-slate-500">ãƒ»ç´„ ${m2str(transit.distanceMeters)}</span>` : ''}
                </div>
              </div>
              <details class="mt-3 group">
                <summary class="cursor-pointer select-none text-sm text-slate-700">ãƒ›ãƒ†ãƒ«ã‚’è¡¨ç¤ºï¼ˆè¿‘ã„é †ï¼‰</summary>
                <div class="mt-3" id="hotels-${a.id}">
                  <div class="text-sm text-slate-500">èª­ã¿è¾¼ã¿ä¸­...</div>
                </div>
              </details>
            </div>
          </div>
        `;
        root.appendChild(card);
        // ãƒ›ãƒ†ãƒ«èª­ã¿è¾¼ã¿ï¼ˆé…å»¶ï¼‰
        const details = card.querySelector('details');
        details.addEventListener('toggle', async () => {
          if (!details.open) return;
          const container = qs(`#hotels-${a.id}`);
          await loadHotelsForAttraction(a, container);
        }, { once: true });
      }
    }

    function renderHotels(container, hotels) {
      if (!hotels || hotels.length === 0) {
        container.innerHTML = '<p class="text-sm text-slate-500">è¿‘éš£ãƒ›ãƒ†ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
        return;
      }
      container.innerHTML = `
        <ul class="space-y-2">
          ${hotels.map(h => `
            <li class="border rounded-xl p-3 flex flex-col md:flex-row md:items-center md:justify-between gap-2">
              <div>
                <p class="font-medium">${h.name}</p>
                <p class="text-xs text-slate-600">${h.address || ''}</p>
                ${h.distanceMeters ? `<p class="text-xs text-slate-500">è¦³å…‰åœ°ã‹ã‚‰ç´„ ${m2str(h.distanceMeters)}</p>` : ''}
              </div>
              <div class="flex items-center gap-3">
                <span class="text-base font-semibold">${h.price ? yen(h.price) : '-'}${h.currency && h.currency !== 'JPY' ? ` <span class="text-xs">(${h.currency})</span>` : ''}</span>
                ${h.url ? `<a href="${h.url}" target="_blank" class="inline-flex items-center gap-1 text-sky-700 hover:underline text-sm">è©³ç´° <span aria-hidden>â†—</span></a>` : ''}
              </div>
            </li>`).join('')}
        </ul>
      `;
    }

    // ãƒˆãƒ¼ã‚¹ãƒˆç°¡æ˜“å®Ÿè£…
    function toast(msg, isError=false) {
      const t = document.createElement('div');
      t.className = `fixed bottom-4 left-1/2 -translate-x-1/2 rounded-xl px-4 py-2 shadow text-sm ${isError ? 'bg-red-600 text-white' : 'bg-slate-800 text-white'}`;
      t.textContent = msg;
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 2200);
    }

    // ============
    // ãƒ‡ãƒ¼ã‚¿å–å¾—
    // ============
    async function fetchAttractions(place) {
    const url = `${API_ENDPOINTS.attractions}?place=${encodeURIComponent(place)}`;
    const res = await fetch(url, { headers: { "Accept": "application/json" } });
    if (!res.ok) {
      let detail = ""; try { detail = (await res.json()).error } catch {}
      throw new Error(`è¦³å…‰åœ°APIã‚¨ãƒ©ãƒ¼ (${res.status}) ${detail || ""}`);
    }
    return res.json(); // ã‚µãƒ¼ãƒã¯ { place, foods, attractions } ã‚’è¿”ã™
    }

    async function fetchHotels({ lat, lng }, limit=4) {
      const url = new URL(API_ENDPOINTS.hotels, location.origin);
      url.searchParams.set('lat', String(lat));
      url.searchParams.set('lng', String(lng));
      url.searchParams.set('limit', String(limit));
      const res = await fetch(url.toString(), { headers: { 'Accept': 'application/json' } });
      if (!res.ok) throw new Error('ãƒ›ãƒ†ãƒ«APIã‚¨ãƒ©ãƒ¼');
      return res.json();
    }

    async function loadHotelsForAttraction(a, container) {
      try {
        const useDemo = qs('#demoToggle').checked;
        let data;
        if (useDemo) {
          await new Promise(r => setTimeout(r, 400));
          data = demoHotels(a.location.lat, a.location.lng, 4);
        } else {
          data = await fetchHotels(a.location, 4);
        }
        renderHotels(container, data.hotels || []);
      } catch (e) {
        container.innerHTML = `<p class="text-sm text-red-600">ãƒ›ãƒ†ãƒ«ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸï¼š${e.message}</p>`;
      }
    }

    // ============
    // ã‚¤ãƒ™ãƒ³ãƒˆ
    // ============
    const form = qs('#searchForm');
    const placeInput = qs('#placeInput');
    const results = qs('#results');
    const summaryCard = qs('#summaryCard');
    const foodsCard = qs('#foodsCard');
    const attractionsRoot = qs('#attractions');
    const statusEl = qs('#status');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const place = placeInput.value.trim();
      if (!place) return;
      results.classList.add('hidden');
      summaryCard.classList.add('hidden');
      foodsCard.classList.add('hidden');
      attractionsRoot.innerHTML = '';
      statusEl.innerHTML = '<div class="inline-flex items-center gap-2 text-slate-600"><span class="animate-spin inline-block w-4 h-4 border-2 border-slate-300 border-t-slate-600 rounded-full"></span> æ¤œç´¢ä¸­â€¦</div>';

      try {
        const useDemo = qs('#demoToggle').checked;
        let data;
        if (useDemo) {
          await new Promise(r => setTimeout(r, 600)); // ãƒ‡ãƒ¢ã‚‰ã—ãå°‘ã—å¾…æ©Ÿ
          data = demoResponse(place);
        } else {
          data = await fetchAttractions(place);
        }

        statusEl.textContent = '';
        results.classList.remove('hidden');
        summaryCard.classList.remove('hidden');
        renderSummary(summaryCard, data);
        renderFoods(foodsCard, data.foods || []);
        renderAttractions(attractionsRoot, data.attractions || []);
        if ((data.foods || []).length > 0) {
          foodsCard.classList.remove('hidden');
        }
      } catch (err) {
        statusEl.innerHTML = `<div class="text-red-600">ã‚¨ãƒ©ãƒ¼: ${err.message}</div>`;
      }
    });

    // ã‚¨ãƒ³ã‚¿ãƒ¼ã§åˆæœŸãƒ•ã‚©ãƒ¼ã‚«ã‚¹
    window.addEventListener('DOMContentLoaded', () => placeInput.focus());
  </script>
</body>
</html>