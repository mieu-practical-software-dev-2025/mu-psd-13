<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>日本の地名から観光地・食べ物・最寄り交通・ホテル表示</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="地名を入力すると、観光地とご当地グルメ、各観光地の最寄り駅/バス停、最寄りホテル（複数）を表示するフロントエンド。バックエンドAPI連携を想定。" />
  <style>
    /* スクロール時のモーション軽減 */
    @media (prefers-reduced-motion: reduce) {
      * { animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration: 0.001ms !important; scroll-behavior: auto !important; }
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <header class="sticky top-0 z-10 bg-white/90 backdrop-blur border-b border-slate-200">
    <div class="max-w-5xl mx-auto p-4">
      <h1 class="text-2xl font-bold">観光スポット & ご当地グルメ & 最寄り交通 & ホテル検索</h1>
      <p class="text-sm text-slate-600">地名（例: 京都、札幌、那覇、鎌倉 など）を入れて検索</p>
    </div>
  </header>

  <main class="max-w-5xl mx-auto p-4 space-y-6">
    <!-- 検索フォーム -->
    <section class="bg-white rounded-2xl shadow p-4">
      <form id="searchForm" class="grid grid-cols-1 md:grid-cols-[1fr_auto_auto] gap-3 items-center">
        <label for="placeInput" class="sr-only">地名</label>
        <input id="placeInput" type="text" inputmode="search" placeholder="例: 金沢 / 福岡 / 日光" class="w-full rounded-xl border border-slate-300 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-sky-400" required />
        <label class="inline-flex items-center gap-2 text-sm text-slate-600 select-none">
          <input id="demoToggle" type="checkbox" class="rounded border-slate-300" /> デモデータを使う
        </label>
        <button type="submit" class="rounded-xl bg-sky-600 hover:bg-sky-700 text-white font-medium px-5 py-3">検索</button>
      </form>
      <p class="mt-2 text-xs text-slate-500">※ バックエンドAPIは別実装想定。エンドポイントURLは本ファイル内の <code>API_ENDPOINTS</code> を変更してください。</p>
    </section>

    <!-- 結果コンテナ -->
    <section id="results" class="space-y-6 hidden">
      <!-- 概要 -->
      <div id="summaryCard" class="bg-white rounded-2xl shadow p-4 hidden"></div>

      <!-- ご当地グルメリスト -->
      <div id="foodsCard" class="bg-white rounded-2xl shadow p-4 hidden"></div>

      <!-- 観光地カード群 -->
      <div id="attractions" class="space-y-4"></div>
    </section>

    <!-- ローディング / エラー表示 -->
    <section id="status" class="text-center text-slate-600"></section>
  </main>

  <footer class="max-w-5xl mx-auto p-8 text-center text-xs text-slate-500">
    フロントエンドのみ。サンプルAPI仕様はコード内コメント参照。
  </footer>

  <script>
    // =====================
    // ★ API 仕様（想定）★
    // =====================
    // 1) 観光地 & ご当地グルメ取得（地名から）
    // GET /api/attractions?place={place}
    // Response JSON 例：
    // {
    //   "place": "京都",
    //   "foods": ["湯豆腐", "抹茶スイーツ", "にしんそば"],
    //   "attractions": [
    //     {
    //       "id": "a1",
    //       "name": "清水寺",
    //       "description": "世界遺産。舞台からの眺望で有名。",
    //       "address": "京都市東山区清水",
    //       "location": { "lat": 34.994856, "lng": 135.785046 },
    //       "nearestTransit": { "type": "bus", "name": "清水道バス停", "lines": ["市バス"], "distanceMeters": 450 }
    //     },
    //     {
    //       "id": "a2",
    //       "name": "伏見稲荷大社",
    //       "description": "千本鳥居で有名。",
    //       "address": "京都市伏見区深草藪之内町68",
    //       "location": { "lat": 34.96714, "lng": 135.77267 },
    //       "nearestTransit": { "type": "station", "name": "稲荷駅", "lines": ["JR奈良線"], "distanceMeters": 120 }
    //     }
    //   ]
    // }
    //
    // 2) ホテル検索（観光地座標から近い順で複数件）
    // GET /api/hotels?lat={lat}&lng={lng}&limit={n}
    // Response JSON 例：
    // {
    //   "hotels": [
    //     { "name": "ホテルA", "price": 12400, "currency": "JPY", "distanceMeters": 220, "address": "...", "url": "https://..." },
    //     { "name": "ホテルB", "price": 14800, "currency": "JPY", "distanceMeters": 350, "address": "...", "url": "https://..." }
    //   ]
    // }

    // === エンドポイント定義（必要に応じて書き換え） ===
    const API_ENDPOINTS = {
    attractions: "/api/attractions",
    hotels: "/api/hotels"
    };

    // ユーティリティ
    const qs = (s, el=document) => el.querySelector(s);
    const qsa = (s, el=document) => [...el.querySelectorAll(s)];
    const yen = (n) => n.toLocaleString("ja-JP", { style: "currency", currency: "JPY" });
    const m2str = (m) => (m >= 1000 ? `${(m/1000).toFixed(1)} km` : `${Math.round(m)} m`);

    // デモデータ（バックエンド未実装時に便利）
    function demoResponse(place) {
      const seed = (place || "").trim() || "鎌倉";
      if (/札幌|北海道/i.test(seed)) {
        return {
          place: "札幌",
          foods: ["ジンギスカン", "スープカレー", "札幌ラーメン"],
          attractions: [
            { id: "s1", name: "大通公園", description: "都心の憩いの場。季節のイベント多数。", address: "札幌市中央区大通西", location: {lat:43.0601,lng:141.3565}, nearestTransit: {type:"station", name:"大通駅", lines:["南北線","東西線","東豊線"], distanceMeters: 180} },
            { id: "s2", name: "藻岩山", description: "日本新三大夜景の一つ。", address: "札幌市南区藻岩山", location: {lat:43.0169,lng:141.3305}, nearestTransit: {type:"bus", name:"もいわ山ロープウェイ入口", lines:["市電⇔バス"], distanceMeters: 420} }
          ]
        };
      }
      // 既定は京都
      return {
        place: "京都",
        foods: ["湯豆腐", "抹茶スイーツ", "にしんそば"],
        attractions: [
          { id: "k1", name: "清水寺", description: "世界遺産。舞台からの眺望で有名。", address: "京都市東山区清水", location: {lat:34.994856,lng:135.785046}, nearestTransit: {type:"bus", name:"清水道バス停", lines:["市バス"], distanceMeters: 450} },
          { id: "k2", name: "伏見稲荷大社", description: "千本鳥居で有名。", address: "京都市伏見区深草藪之内町68", location: {lat:34.96714,lng:135.77267}, nearestTransit: {type:"station", name:"稲荷駅", lines:["JR奈良線"], distanceMeters: 120} }
        ]
      };
    }

    function demoHotels(lat, lng, limit=4) {
      const base = [
        { name: "ホテル雅", price: 12400, currency: "JPY", distanceMeters: 220, address: "〇〇市△△1-2-3", url: "https://example.com/hotel/miyabi" },
        { name: "旅館 ことのは", price: 15800, currency: "JPY", distanceMeters: 410, address: "〇〇市□□2-3-4", url: "https://example.com/hotel/kotonoha" },
        { name: "○○イン", price: 9800, currency: "JPY", distanceMeters: 530, address: "〇〇市××3-4-5", url: "https://example.com/hotel/inn" },
        { name: "プレミアムホテル△△", price: 17600, currency: "JPY", distanceMeters: 690, address: "〇〇市☆彡4-5-6", url: "https://example.com/hotel/premium" }
      ];
      return { hotels: base.slice(0, limit) };
    }

    // ============
    // 描画ヘルパ
    // ============
    function renderSummary(root, data) {
      root.innerHTML = `
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2">
          <div>
            <h2 class="text-xl font-semibold">${data.place} の検索結果</h2>
            <p class="text-slate-600 text-sm">観光地 ${data.attractions.length} 件 / ご当地グルメ ${data.foods?.length || 0} 件</p>
          </div>
          <button id="copyBtn" class="mt-2 md:mt-0 inline-flex items-center gap-2 rounded-xl border px-3 py-2 text-sm hover:bg-slate-50">この結果のJSONをコピー</button>
        </div>`;
      qs('#copyBtn', root).addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(JSON.stringify(data, null, 2));
          toast('JSONをコピーしました');
        } catch {
          toast('コピーに失敗しました', true);
        }
      });
    }

    function renderFoods(root, foods) {
      if (!foods || foods.length === 0) { root.classList.add('hidden'); return; }
      root.classList.remove('hidden');
      root.innerHTML = `
        <h3 class="text-lg font-semibold mb-2">ご当地グルメ</h3>
        <ul class="flex flex-wrap gap-2">${foods.map(f => `<li class="px-3 py-1 rounded-full bg-slate-100 border text-sm">${f}</li>`).join('')}</ul>
      `;
    }

    function renderAttractions(root, attractions) {
      root.innerHTML = '';
      for (const a of attractions) {
        const card = document.createElement('article');
        card.className = 'bg-white rounded-2xl shadow p-4';
        const transit = a.nearestTransit;
        const transitIcon = transit?.type === 'station' ? '🚉' : '🚌';
        const lines = (transit?.lines || []).join(' / ');
        card.innerHTML = `
          <div class="flex items-start gap-3">
            <div class="text-2xl">📍</div>
            <div class="flex-1">
              <h4 class="text-lg font-semibold">${a.name}</h4>
              <p class="text-sm text-slate-600">${a.description || ''}</p>
              <p class="text-sm text-slate-600 mt-1">住所: ${a.address || '-'} </p>
              <div class="mt-2 text-sm">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-sky-50 border border-sky-200">
                  <span>${transitIcon} 最寄り${transit?.type === 'station' ? '駅' : 'バス停'}</span>
                  <strong>${transit?.name || '-'}</strong>
                  ${lines ? `<span class="text-slate-500">(${lines})</span>` : ''}
                  ${transit?.distanceMeters ? `<span class="text-slate-500">・約 ${m2str(transit.distanceMeters)}</span>` : ''}
                </div>
              </div>
              <details class="mt-3 group">
                <summary class="cursor-pointer select-none text-sm text-slate-700">ホテルを表示（近い順）</summary>
                <div class="mt-3" id="hotels-${a.id}">
                  <div class="text-sm text-slate-500">読み込み中...</div>
                </div>
              </details>
            </div>
          </div>
        `;
        root.appendChild(card);
        // ホテル読み込み（遅延）
        const details = card.querySelector('details');
        details.addEventListener('toggle', async () => {
          if (!details.open) return;
          const container = qs(`#hotels-${a.id}`);
          await loadHotelsForAttraction(a, container);
        }, { once: true });
      }
    }

    function renderHotels(container, hotels) {
      if (!hotels || hotels.length === 0) {
        container.innerHTML = '<p class="text-sm text-slate-500">近隣ホテルが見つかりませんでした。</p>';
        return;
      }
      container.innerHTML = `
        <ul class="space-y-2">
          ${hotels.map(h => `
            <li class="border rounded-xl p-3 flex flex-col md:flex-row md:items-center md:justify-between gap-2">
              <div>
                <p class="font-medium">${h.name}</p>
                <p class="text-xs text-slate-600">${h.address || ''}</p>
                ${h.distanceMeters ? `<p class="text-xs text-slate-500">観光地から約 ${m2str(h.distanceMeters)}</p>` : ''}
              </div>
              <div class="flex items-center gap-3">
                <span class="text-base font-semibold">${h.price ? yen(h.price) : '-'}${h.currency && h.currency !== 'JPY' ? ` <span class="text-xs">(${h.currency})</span>` : ''}</span>
                ${h.url ? `<a href="${h.url}" target="_blank" class="inline-flex items-center gap-1 text-sky-700 hover:underline text-sm">詳細 <span aria-hidden>↗</span></a>` : ''}
              </div>
            </li>`).join('')}
        </ul>
      `;
    }

    // トースト簡易実装
    function toast(msg, isError=false) {
      const t = document.createElement('div');
      t.className = `fixed bottom-4 left-1/2 -translate-x-1/2 rounded-xl px-4 py-2 shadow text-sm ${isError ? 'bg-red-600 text-white' : 'bg-slate-800 text-white'}`;
      t.textContent = msg;
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 2200);
    }

    // ============
    // データ取得
    // ============
    async function fetchAttractions(place) {
    const url = `${API_ENDPOINTS.attractions}?place=${encodeURIComponent(place)}`;
    const res = await fetch(url, { headers: { "Accept": "application/json" } });
    if (!res.ok) {
      let detail = ""; try { detail = (await res.json()).error } catch {}
      throw new Error(`観光地APIエラー (${res.status}) ${detail || ""}`);
    }
    return res.json(); // サーバは { place, foods, attractions } を返す
    }

    async function fetchHotels({ lat, lng }, limit=4) {
      const url = new URL(API_ENDPOINTS.hotels, location.origin);
      url.searchParams.set('lat', String(lat));
      url.searchParams.set('lng', String(lng));
      url.searchParams.set('limit', String(limit));
      const res = await fetch(url.toString(), { headers: { 'Accept': 'application/json' } });
      if (!res.ok) throw new Error('ホテルAPIエラー');
      return res.json();
    }

    async function loadHotelsForAttraction(a, container) {
      try {
        const useDemo = qs('#demoToggle').checked;
        let data;
        if (useDemo) {
          await new Promise(r => setTimeout(r, 400));
          data = demoHotels(a.location.lat, a.location.lng, 4);
        } else {
          data = await fetchHotels(a.location, 4);
        }
        renderHotels(container, data.hotels || []);
      } catch (e) {
        container.innerHTML = `<p class="text-sm text-red-600">ホテルの取得に失敗しました：${e.message}</p>`;
      }
    }

    // ============
    // イベント
    // ============
    const form = qs('#searchForm');
    const placeInput = qs('#placeInput');
    const results = qs('#results');
    const summaryCard = qs('#summaryCard');
    const foodsCard = qs('#foodsCard');
    const attractionsRoot = qs('#attractions');
    const statusEl = qs('#status');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const place = placeInput.value.trim();
      if (!place) return;
      results.classList.add('hidden');
      summaryCard.classList.add('hidden');
      foodsCard.classList.add('hidden');
      attractionsRoot.innerHTML = '';
      statusEl.innerHTML = '<div class="inline-flex items-center gap-2 text-slate-600"><span class="animate-spin inline-block w-4 h-4 border-2 border-slate-300 border-t-slate-600 rounded-full"></span> 検索中…</div>';

      try {
        const useDemo = qs('#demoToggle').checked;
        let data;
        if (useDemo) {
          await new Promise(r => setTimeout(r, 600)); // デモらしく少し待機
          data = demoResponse(place);
        } else {
          data = await fetchAttractions(place);
        }

        statusEl.textContent = '';
        results.classList.remove('hidden');
        summaryCard.classList.remove('hidden');
        renderSummary(summaryCard, data);
        renderFoods(foodsCard, data.foods || []);
        renderAttractions(attractionsRoot, data.attractions || []);
        if ((data.foods || []).length > 0) {
          foodsCard.classList.remove('hidden');
        }
      } catch (err) {
        statusEl.innerHTML = `<div class="text-red-600">エラー: ${err.message}</div>`;
      }
    });

    // エンターで初期フォーカス
    window.addEventListener('DOMContentLoaded', () => placeInput.focus());
  </script>
</body>
</html>